<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        // Firebase SDK (using modular syntax)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDB7ISeqMg9amQMqSC-RmVKVh8F6CV1vT8",
  authDomain: "url-shortner-9afc0.firebaseapp.com",
  projectId: "url-shortner-9afc0",
  storageBucket: "url-shortner-9afc0.firebasestorage.app",
  messagingSenderId: "29716485939",
  appId: "1:29716485939:web:947b3b4a9b7f0c79189046"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function shortenUrl() {
            const longUrl = document.getElementById("longUrl").value;
            if (!longUrl) {
                alert("Please enter a URL.");
                return;
            }

            // Generate a random 6-digit shortcode
            const shortCode = Math.floor(100000 + Math.random() * 900000).toString();

            // GitHub API token (replace with your personal token)
            const token = 'YOUR_GITHUB_TOKEN';
            const repoName = `shortened-${shortCode}`;

            // GitHub API URL to create a new repository
            const createRepoUrl = `https://api.github.com/user/repos`;

            const repoData = {
                name: repoName,
                private: false,  // You can set this to `true` if you want the repo to be private
                description: `Shortened URL for ${longUrl}`
            };

            // Create a repository via GitHub API
            try {
                const response = await fetch(createRepoUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(repoData)
                });

                if (response.ok) {
                    const repo = await response.json();
                    const repoUrl = `https://github.com/${repo.owner.login}/${repo.name}`;

                    // Add redirect script to the repository (create index.html)
                    await createRedirectScript(repoUrl, shortCode, longUrl);

                    // Save the shortened URL in Firestore
                    await db.collection("shortUrls").doc(shortCode).set({
                        longURL: longUrl,
                        clicks: 0,
                        repoUrl: repoUrl
                    });

                    // Display shortened URL
                    document.getElementById("result").innerHTML = 
                        `Shortened: <a href="https://${repo.owner.login}.github.io/${repo.name}" target="_blank">${repo.owner.login}.github.io/${repo.name}</a>`;

                } else {
                    throw new Error('Failed to create GitHub repository');
                }
            } catch (error) {
                console.error("Error creating repository:", error);
                alert("Error creating URL shortener. Check console for details.");
            }
        }

        async function createRedirectScript(repoUrl, shortCode, longUrl) {
            const redirectScript = `
            <!DOCTYPE html>
            <html lang="en">
  
